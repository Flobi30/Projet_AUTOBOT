{% extends "base.html" %}
{% block title %}Paramètres{% endblock %}
{% block content %}
<div class="page-container">
    <div class="page-header">
        <div class="page-title-section">
            <div class="page-icon">
                <i class="fas fa-cog"></i>
            </div>
            <h1 class="page-title">PARAMÈTRES</h1>
        </div>
    </div>

    <div class="form-section">
        <h3>Configuration Système</h3>
        <div class="form-grid">
            <div class="form-group">
                <label>Mode de trading</label>
                <select class="form-control" name="trading_mode">
                    <option value="automatic">Automatique</option>
                    <option value="manual">Manuel</option>
                    <option value="hybrid">Hybride</option>
                </select>
            </div>
            <div class="form-group">
                <label>Niveau de risque</label>
                <select class="form-control" name="risk_level">
                    <option value="conservative">Conservateur</option>
                    <option value="moderate">Modéré</option>
                    <option value="aggressive">Agressif</option>
                </select>
            </div>
        </div>
        <button class="btn-save" onclick="saveSystemConfig()">Sauvegarder</button>
    </div>

    <div class="form-section">
        <h3>Configuration des Clés API</h3>
        
        <div class="api-provider">
            <div class="provider-header">
                <span class="provider-status active"></span>
                <span class="provider-name">Binance</span>
            </div>
            <div class="form-grid">
                <input type="text" class="form-control" placeholder="API Key" name="binance_api_key">
                <input type="password" class="form-control" placeholder="API Secret" name="binance_api_secret">
            </div>
        </div>

        <div class="api-provider">
            <div class="provider-header">
                <span class="provider-status active"></span>
                <span class="provider-name">NewsAPI</span>
            </div>
            <div class="form-grid">
                <input type="text" class="form-control" placeholder="API Key" name="newsapi_key">
            </div>
        </div>

        <div class="api-provider">
            <div class="provider-header">
                <span class="provider-status active"></span>
                <span class="provider-name">Shopify</span>
            </div>
            <div class="form-grid">
                <input type="text" class="form-control" placeholder="API Key" name="shopify_api_key">
                <input type="text" class="form-control" placeholder="Shop Name" name="shopify_shop_name">
            </div>
        </div>

        <div class="api-provider">
            <div class="provider-header">
                <span class="provider-status active"></span>
                <span class="provider-name">Alpha Vantage</span>
            </div>
            <div class="form-grid">
                <input type="text" class="form-control" placeholder="API Key" name="alpha_vantage_api_key">
            </div>
        </div>

        <div class="api-provider">
            <div class="provider-header">
                <span class="provider-status active"></span>
                <span class="provider-name">Coinbase</span>
            </div>
            <div class="form-grid">
                <input type="text" class="form-control" placeholder="API Key" name="coinbase_api_key">
                <input type="password" class="form-control" placeholder="API Secret" name="coinbase_api_secret">
                <input type="text" class="form-control" placeholder="Passphrase" name="coinbase_passphrase">
            </div>
        </div>

        <div class="api-provider">
            <div class="provider-header">
                <span class="provider-status active"></span>
                <span class="provider-name">Kraken</span>
            </div>
            <div class="form-grid">
                <input type="text" class="form-control" placeholder="API Key" name="kraken_api_key">
                <input type="password" class="form-control" placeholder="API Secret" name="kraken_api_secret">
            </div>
        </div>

        <div class="api-provider">
            <div class="provider-header">
                <span class="provider-status active"></span>
                <span class="provider-name">Twelve Data</span>
            </div>
            <div class="form-grid">
                <input type="text" class="form-control" placeholder="API Key" name="twelve_data_api_key">
            </div>
        </div>

        <div class="api-provider">
            <div class="provider-header">
                <span class="provider-status active"></span>
                <span class="provider-name">FRED</span>
            </div>
            <div class="form-grid">
                <input type="text" class="form-control" placeholder="API Key" name="fred_api_key">
            </div>
        </div>

        <button class="btn-save" onclick="saveApiKeys()">Sauvegarder les Clés API</button>
    </div>

    <script>
    function saveSystemConfig() {
        const formData = new FormData();
        formData.append('trading_mode', document.querySelector('[name="trading_mode"]').value);
        formData.append('risk_level', document.querySelector('[name="risk_level"]').value);
        
        fetch('/api/save-system-config', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Configuration système sauvegardée avec succès', 'success');
            } else {
                showNotification('Erreur lors de la sauvegarde', 'error');
            }
        })
        .catch(error => {
            showNotification('Erreur de connexion', 'error');
        });
    }

    function saveApiKeys() {
        const formData = new FormData();
        const apiKeys = [
            'binance_api_key', 'binance_api_secret',
            'newsapi_key',
            'shopify_api_key', 'shopify_shop_name',
            'alpha_vantage_api_key',
            'coinbase_api_key', 'coinbase_api_secret', 'coinbase_passphrase',
            'kraken_api_key', 'kraken_api_secret',
            'twelve_data_api_key',
            'fred_api_key'
        ];
        
        apiKeys.forEach(key => {
            const element = document.querySelector(`[name="${key}"]`);
            if (element && element.value) {
                formData.append(key, element.value);
            }
        });
        
        fetch('/api/save-api-keys', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Clés API sauvegardées avec succès', 'success');
            } else {
                showNotification('Erreur lors de la sauvegarde', 'error');
            }
        })
        .catch(error => {
            showNotification('Erreur de connexion', 'error');
        });
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 6px;
            color: #fff;
            font-weight: 600;
            z-index: 1000;
            background: ${type === 'success' ? 'var(--primary-color)' : '#ff4444'};
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }
    </script>
</div>
{% endblock %}
