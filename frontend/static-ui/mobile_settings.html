<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AUTOBOT - Settings Mobile</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/mobile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="dark-theme">
    <div class="mobile-container">
        <!-- Header -->
        <header class="mobile-header">
            <div class="logo-container">
                <img src="/static/img/logo.png" alt="AUTOBOT Logo" class="logo">
            </div>
            <nav class="nav-menu">
                <ul>
                    <li><a href="/mobile"><i class="fas fa-chart-line"></i> Dashboard</a></li>
                    <li><a href="/mobile/trading"><i class="fas fa-exchange-alt"></i> Trading</a></li>
                    <li><a href="/mobile/ecommerce"><i class="fas fa-shopping-cart"></i> E-commerce</a></li>
                    <li><a href="/mobile/rl-training"><i class="fas fa-brain"></i> RL Training</a></li>
                    <li><a href="/mobile/settings" class="active"><i class="fas fa-cog"></i> Settings</a></li>
                    <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </nav>
        </header>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- User Profile -->
            <section class="collapsible-section">
                <div class="collapsible-header active">
                    <h2><i class="fas fa-user"></i> User Profile</h2>
                </div>
                <div class="collapsible-content" style="max-height: 500px;">
                    <div class="user-profile">
                        <div class="profile-avatar">
                            <img src="https://via.placeholder.com/100" alt="User Avatar">
                            <button class="btn btn-sm btn-primary avatar-edit-btn">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <div class="profile-info">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" class="form-control" value="JeanDupont">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" class="form-control" value="jean.dupont@example.com">
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone</label>
                                <input type="tel" id="phone" class="form-control" value="+33 6 12 34 56 78">
                            </div>
                            <div class="form-group">
                                <label for="language">Language</label>
                                <select id="language" class="form-control">
                                    <option value="fr" selected>Français</option>
                                    <option value="en">English</option>
                                    <option value="es">Español</option>
                                    <option value="de">Deutsch</option>
                                </select>
                            </div>
                            <button class="btn btn-primary btn-block">
                                <i class="fas fa-save"></i> Save Profile
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- API Keys -->
            <section class="collapsible-section">
                <div class="collapsible-header">
                    <h2><i class="fas fa-key"></i> API Keys</h2>
                </div>
                <div class="collapsible-content">
                    <div class="api-keys-section">
                        <div class="exchange-item">
                            <div class="exchange-header">
                                <h3>Binance</h3>
                                <span class="status-badge connected">Connected</span>
                            </div>
                            <div class="exchange-form">
                                <div class="form-group">
                                    <label for="binance-api-key">API Key</label>
                                    <div class="input-with-action">
                                        <input type="password" id="binance-api-key" class="form-control" value="••••••••••••••••••••••">
                                        <button class="btn btn-sm btn-secondary toggle-password">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="binance-api-secret">API Secret</label>
                                    <div class="input-with-action">
                                        <input type="password" id="binance-api-secret" class="form-control" value="••••••••••••••••••••••">
                                        <button class="btn btn-sm btn-secondary toggle-password">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="binance-testnet" class="form-checkbox">
                                        <label for="binance-testnet">Use Testnet</label>
                                    </div>
                                </div>
                                <div class="exchange-actions">
                                    <button class="btn btn-primary update-exchange-btn" data-exchange="binance">Update</button>
                                    <button class="btn btn-danger disconnect-exchange-btn" data-exchange="binance">Disconnect</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="exchange-item">
                            <div class="exchange-header">
                                <h3>Kraken</h3>
                                <span class="status-badge disconnected">Not Connected</span>
                            </div>
                            <div class="exchange-form">
                                <div class="form-group">
                                    <label for="kraken-api-key">API Key</label>
                                    <input type="text" id="kraken-api-key" class="form-control" placeholder="Enter API Key">
                                </div>
                                <div class="form-group">
                                    <label for="kraken-api-secret">API Secret</label>
                                    <input type="password" id="kraken-api-secret" class="form-control" placeholder="Enter API Secret">
                                </div>
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="kraken-testnet" class="form-checkbox">
                                        <label for="kraken-testnet">Use Testnet</label>
                                    </div>
                                </div>
                                <div class="exchange-actions">
                                    <button class="btn btn-primary connect-exchange-btn" data-exchange="kraken">Connect</button>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-secondary btn-block add-exchange-btn">
                            <i class="fas fa-plus"></i> Add Exchange
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Trading Settings -->
            <section class="collapsible-section">
                <div class="collapsible-header">
                    <h2><i class="fas fa-chart-line"></i> Trading Settings</h2>
                </div>
                <div class="collapsible-content">
                    <div class="trading-settings">
                        <div class="form-group">
                            <label for="default-exchange">Default Exchange</label>
                            <select id="default-exchange" class="form-control">
                                <option value="binance" selected>Binance</option>
                                <option value="kraken">Kraken</option>
                                <option value="coinbase">Coinbase</option>
                                <option value="kucoin">KuCoin</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="default-pair">Default Trading Pair</label>
                            <select id="default-pair" class="form-control">
                                <option value="btc-eur" selected>BTC/EUR</option>
                                <option value="eth-eur">ETH/EUR</option>
                                <option value="xrp-eur">XRP/EUR</option>
                                <option value="ltc-eur">LTC/EUR</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="default-strategy">Default Strategy</label>
                            <select id="default-strategy" class="form-control">
                                <option value="ppo-agent" selected>PPO Agent</option>
                                <option value="moving-average">Moving Average</option>
                                <option value="rsi">RSI</option>
                                <option value="macd">MACD</option>
                                <option value="bollinger">Bollinger Bands</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="risk-level">Risk Level</label>
                            <input type="range" id="risk-level" class="form-range" min="1" max="10" step="1" value="5">
                            <div class="range-value">5 - Moderate</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="max-position-size">Max Position Size (% of Portfolio)</label>
                            <input type="range" id="max-position-size" class="form-range" min="1" max="100" step="1" value="20">
                            <div class="range-value">20%</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="stop-loss">Default Stop Loss (%)</label>
                            <input type="number" id="stop-loss" class="form-control" value="5" min="0.1" max="50" step="0.1">
                        </div>
                        
                        <div class="form-group">
                            <label for="take-profit">Default Take Profit (%)</label>
                            <input type="number" id="take-profit" class="form-control" value="10" min="0.1" max="100" step="0.1">
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="auto-trading" class="form-checkbox" checked>
                                <label for="auto-trading">Enable Automated Trading</label>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> Save Trading Settings
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Notifications -->
            <section class="collapsible-section">
                <div class="collapsible-header">
                    <h2><i class="fas fa-bell"></i> Notifications</h2>
                </div>
                <div class="collapsible-content">
                    <div class="notification-settings">
                        <div class="notification-group">
                            <h3>Trading Notifications</h3>
                            <div class="notification-option">
                                <div class="option-label">
                                    <span>Trade Executed</span>
                                </div>
                                <div class="option-toggles">
                                    <div class="toggle-group">
                                        <input type="checkbox" id="trade-executed-app" class="toggle-checkbox" checked>
                                        <label for="trade-executed-app" class="toggle-label">App</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="trade-executed-email" class="toggle-checkbox" checked>
                                        <label for="trade-executed-email" class="toggle-label">Email</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="trade-executed-sms" class="toggle-checkbox">
                                        <label for="trade-executed-sms" class="toggle-label">SMS</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="notification-option">
                                <div class="option-label">
                                    <span>Stop Loss Triggered</span>
                                </div>
                                <div class="option-toggles">
                                    <div class="toggle-group">
                                        <input type="checkbox" id="stop-loss-app" class="toggle-checkbox" checked>
                                        <label for="stop-loss-app" class="toggle-label">App</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="stop-loss-email" class="toggle-checkbox" checked>
                                        <label for="stop-loss-email" class="toggle-label">Email</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="stop-loss-sms" class="toggle-checkbox" checked>
                                        <label for="stop-loss-sms" class="toggle-label">SMS</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="notification-option">
                                <div class="option-label">
                                    <span>Price Alert</span>
                                </div>
                                <div class="option-toggles">
                                    <div class="toggle-group">
                                        <input type="checkbox" id="price-alert-app" class="toggle-checkbox" checked>
                                        <label for="price-alert-app" class="toggle-label">App</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="price-alert-email" class="toggle-checkbox">
                                        <label for="price-alert-email" class="toggle-label">Email</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="price-alert-sms" class="toggle-checkbox">
                                        <label for="price-alert-sms" class="toggle-label">SMS</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="notification-group">
                            <h3>E-commerce Notifications</h3>
                            <div class="notification-option">
                                <div class="option-label">
                                    <span>New Order</span>
                                </div>
                                <div class="option-toggles">
                                    <div class="toggle-group">
                                        <input type="checkbox" id="new-order-app" class="toggle-checkbox" checked>
                                        <label for="new-order-app" class="toggle-label">App</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="new-order-email" class="toggle-checkbox" checked>
                                        <label for="new-order-email" class="toggle-label">Email</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="new-order-sms" class="toggle-checkbox">
                                        <label for="new-order-sms" class="toggle-label">SMS</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="notification-option">
                                <div class="option-label">
                                    <span>Inventory Alert</span>
                                </div>
                                <div class="option-toggles">
                                    <div class="toggle-group">
                                        <input type="checkbox" id="inventory-app" class="toggle-checkbox" checked>
                                        <label for="inventory-app" class="toggle-label">App</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="inventory-email" class="toggle-checkbox" checked>
                                        <label for="inventory-email" class="toggle-label">Email</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="inventory-sms" class="toggle-checkbox">
                                        <label for="inventory-sms" class="toggle-label">SMS</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="notification-group">
                            <h3>System Notifications</h3>
                            <div class="notification-option">
                                <div class="option-label">
                                    <span>System Updates</span>
                                </div>
                                <div class="option-toggles">
                                    <div class="toggle-group">
                                        <input type="checkbox" id="system-app" class="toggle-checkbox" checked>
                                        <label for="system-app" class="toggle-label">App</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="system-email" class="toggle-checkbox" checked>
                                        <label for="system-email" class="toggle-label">Email</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="system-sms" class="toggle-checkbox">
                                        <label for="system-sms" class="toggle-label">SMS</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="notification-option">
                                <div class="option-label">
                                    <span>Security Alerts</span>
                                </div>
                                <div class="option-toggles">
                                    <div class="toggle-group">
                                        <input type="checkbox" id="security-app" class="toggle-checkbox" checked>
                                        <label for="security-app" class="toggle-label">App</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="security-email" class="toggle-checkbox" checked>
                                        <label for="security-email" class="toggle-label">Email</label>
                                    </div>
                                    <div class="toggle-group">
                                        <input type="checkbox" id="security-sms" class="toggle-checkbox" checked>
                                        <label for="security-sms" class="toggle-label">SMS</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> Save Notification Settings
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Security -->
            <section class="collapsible-section">
                <div class="collapsible-header">
                    <h2><i class="fas fa-shield-alt"></i> Security</h2>
                </div>
                <div class="collapsible-content">
                    <div class="security-settings">
                        <div class="form-group">
                            <label for="current-password">Current Password</label>
                            <input type="password" id="current-password" class="form-control" placeholder="Enter current password">
                        </div>
                        
                        <div class="form-group">
                            <label for="new-password">New Password</label>
                            <input type="password" id="new-password" class="form-control" placeholder="Enter new password">
                        </div>
                        
                        <div class="form-group">
                            <label for="confirm-password">Confirm New Password</label>
                            <input type="password" id="confirm-password" class="form-control" placeholder="Confirm new password">
                        </div>
                        
                        <div class="password-strength">
                            <div class="strength-label">Password Strength</div>
                            <div class="strength-meter">
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                            </div>
                            <div class="strength-text">Strong</div>
                        </div>
                        
                        <button class="btn btn-primary btn-block">
                            <i class="fas fa-key"></i> Change Password
                        </button>
                        
                        <div class="security-divider"></div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="two-factor" class="form-checkbox" checked>
                                <label for="two-factor">Enable Two-Factor Authentication</label>
                            </div>
                        </div>
                        
                        <div class="two-factor-status">
                            <div class="status-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="status-text">
                                <div class="status-title">Two-Factor Authentication is enabled</div>
                                <div class="status-description">Your account is protected with an additional layer of security.</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-secondary btn-block">
                            <i class="fas fa-sync"></i> Reconfigure Two-Factor Authentication
                        </button>
                        
                        <div class="security-divider"></div>
                        
                        <div class="form-group">
                            <label>Active Sessions</label>
                            <div class="sessions-list">
                                <div class="session-item current">
                                    <div class="session-icon">
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                    <div class="session-details">
                                        <div class="session-device">iPhone 13 Pro - Paris, France</div>
                                        <div class="session-time">Current session</div>
                                    </div>
                                    <div class="session-actions">
                                        <span class="current-badge">Current</span>
                                    </div>
                                </div>
                                
                                <div class="session-item">
                                    <div class="session-icon">
                                        <i class="fas fa-laptop"></i>
                                    </div>
                                    <div class="session-details">
                                        <div class="session-device">MacBook Pro - Paris, France</div>
                                        <div class="session-time">Last active: 2 hours ago</div>
                                    </div>
                                    <div class="session-actions">
                                        <button class="btn btn-sm btn-danger">Logout</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-danger btn-block">
                            <i class="fas fa-sign-out-alt"></i> Logout from All Devices
                        </button>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="/mobile" class="bottom-nav-item">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="/mobile/trading" class="bottom-nav-item">
                <i class="fas fa-chart-line"></i>
                <span>Trading</span>
            </a>
            <a href="/mobile/ecommerce" class="bottom-nav-item">
                <i class="fas fa-shopping-cart"></i>
                <span>Shop</span>
            </a>
            <a href="/mobile/rl-training" class="bottom-nav-item">
                <i class="fas fa-brain"></i>
                <span>AI</span>
            </a>
            <a href="/mobile/settings" class="bottom-nav-item active">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>

    <script src="/static/js/mobile.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle password visibility
            const toggleButtons = document.querySelectorAll('.toggle-password');
            toggleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input');
                    const icon = this.querySelector('i');
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        input.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                });
            });
            
            // Exchange API key update handlers
            const updateExchangeButtons = document.querySelectorAll('.update-exchange-btn');
            updateExchangeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const exchange = this.getAttribute('data-exchange');
                    updateExchangeSettings(exchange);
                });
            });
            
            // Exchange connect handlers
            const connectExchangeButtons = document.querySelectorAll('.connect-exchange-btn');
            connectExchangeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const exchange = this.getAttribute('data-exchange');
                    connectExchange(exchange);
                });
            });
            
            // Exchange disconnect handlers
            const disconnectExchangeButtons = document.querySelectorAll('.disconnect-exchange-btn');
            disconnectExchangeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const exchange = this.getAttribute('data-exchange');
                    disconnectExchange(exchange);
                });
            });
            
            // Range input value display
            const rangeInputs = document.querySelectorAll('.form-range');
            rangeInputs.forEach(input => {
                const valueDisplay = input.nextElementSibling;
                
                input.addEventListener('input', function() {
                    if (this.id === 'risk-level') {
                        let riskText = '';
                        const value = parseInt(this.value);
                        
                        if (value <= 2) riskText = ' - Very Low';
                        else if (value <= 4) riskText = ' - Low';
                        else if (value <= 6) riskText = ' - Moderate';
                        else if (value <= 8) riskText = ' - High';
                        else riskText = ' - Very High';
                        
                        valueDisplay.textContent = this.value + riskText;
                    } else if (this.id === 'max-position-size') {
                        valueDisplay.textContent = this.value + '%';
                    } else {
                        valueDisplay.textContent = this.value;
                    }
                });
            });
            
            // Password strength meter
            const newPasswordInput = document.getElementById('new-password');
            const strengthMeter = document.querySelector('.strength-meter');
            const strengthText = document.querySelector('.strength-text');
            const strengthSegments = document.querySelectorAll('.strength-segment');
            
            if (newPasswordInput) {
                newPasswordInput.addEventListener('input', function() {
                    const password = this.value;
                    let strength = 0;
                    
                    if (password.length >= 8) strength++;
                    if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
                    if (password.match(/\d/)) strength++;
                    if (password.match(/[^a-zA-Z\d]/)) strength++;
                    
                    strengthSegments.forEach((segment, index) => {
                        if (index < strength) {
                            segment.classList.add('active');
                        } else {
                            segment.classList.remove('active');
                        }
                    });
                    
                    if (strength === 0) {
                        strengthText.textContent = 'Weak';
                        strengthText.className = 'strength-text weak';
                    } else if (strength === 1) {
                        strengthText.textContent = 'Fair';
                        strengthText.className = 'strength-text fair';
                    } else if (strength === 2) {
                        strengthText.textContent = 'Good';
                        strengthText.className = 'strength-text good';
                    } else if (strength === 3) {
                        strengthText.textContent = 'Strong';
                        strengthText.className = 'strength-text strong';
                    } else {
                        strengthText.textContent = 'Very Strong';
                        strengthText.className = 'strength-text very-strong';
                    }
                });
            }
            
            // Functions for exchange API management
            function updateExchangeSettings(exchange) {
                const button = document.querySelector(`.update-exchange-btn[data-exchange="${exchange}"]`);
                const originalText = button.textContent;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
                button.disabled = true;
                
                // Collect form data
                const apiKey = document.getElementById(`${exchange}-api-key`).value;
                const apiSecret = document.getElementById(`${exchange}-api-secret`).value;
                const useTestnet = document.getElementById(`${exchange}-testnet`)?.checked || false;
                
                // Validate inputs
                if (!apiKey || !apiSecret) {
                    showMobileNotification('API Key and Secret are required', 'error');
                    button.innerHTML = originalText;
                    button.disabled = false;
                    return;
                }
                
                // Send to server
                fetch('/api/mobile/update-exchange', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        exchange: exchange,
                        api_key: apiKey,
                        api_secret: apiSecret,
                        use_testnet: useTestnet
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    showMobileNotification(data.message || 'Exchange settings updated successfully', 'success');
                    
                    // Update UI to show connected status if needed
                    const statusBadge = document.querySelector(`.exchange-item:has(#${exchange}-api-key) .status-badge`);
                    if (statusBadge) {
                        statusBadge.className = 'status-badge connected';
                        statusBadge.textContent = 'Connected';
                    }
                })
                .catch(error => {
                    console.error('Error updating exchange settings:', error);
                    showMobileNotification('Error updating exchange settings', 'error');
                })
                .finally(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                });
            }
            
            function connectExchange(exchange) {
                const button = document.querySelector(`.connect-exchange-btn[data-exchange="${exchange}"]`);
                const originalText = button.textContent;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connecting...';
                button.disabled = true;
                
                // Same logic as updateExchangeSettings but for initial connection
                updateExchangeSettings(exchange);
            }
            
            function disconnectExchange(exchange) {
                if (!confirm(`Are you sure you want to disconnect from ${exchange.charAt(0).toUpperCase() + exchange.slice(1)}?`)) {
                    return;
                }
                
                const button = document.querySelector(`.disconnect-exchange-btn[data-exchange="${exchange}"]`);
                const originalText = button.textContent;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Disconnecting...';
                button.disabled = true;
                
                fetch('/api/mobile/disconnect-exchange', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        exchange: exchange
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    showMobileNotification(data.message || 'Exchange disconnected successfully', 'success');
                    
                    // Update UI to show disconnected status
                    const statusBadge = document.querySelector(`.exchange-item:has(#${exchange}-api-key) .status-badge`);
                    if (statusBadge) {
                        statusBadge.className = 'status-badge disconnected';
                        statusBadge.textContent = 'Not Connected';
                    }
                    
                    // Clear input fields
                    document.getElementById(`${exchange}-api-key`).value = '';
                    document.getElementById(`${exchange}-api-secret`).value = '';
                    
                    // Update button if needed
                    const updateButton = document.querySelector(`.update-exchange-btn[data-exchange="${exchange}"]`);
                    if (updateButton) {
                        updateButton.textContent = 'Connect';
                        updateButton.className = 'btn btn-primary connect-exchange-btn';
                    }
                })
                .catch(error => {
                    console.error('Error disconnecting exchange:', error);
                    showMobileNotification('Error disconnecting exchange', 'error');
                })
                .finally(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                });
            }
            
            function showMobileNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `mobile-notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    </div>
                    <div class="notification-message">${message}</div>
                `;
                
                // Add to document
                document.body.appendChild(notification);
                
                // Show with animation
                setTimeout(() => {
                    notification.classList.add('show');
                }, 10);
                
                // Auto-remove after delay
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 5000);
            }
        });
    </script>
</body>
</html>
